## RP5-Scrapper

Скрипт предназначен для загрузки геоданных с сайта [RP5](https://rp5.ru).

**<span style="color:red">Внимание!</span> Для запуска скрипта необходимо наличие установленного [ChromeDriver](https://chromedriver.chromium.org/) и зависимостей из файла `./requirements.txt`**

### Запуск скрипта:

```bash
make run min_date=2023-01-15 max_date=2023-02-10
```
_где <u>2023-01-15</u> и <u>2023-02-10</u> - диапазон дат интересующих данных_

---

### Сборка и запуск скрипта по расписанию

```bash
make build
```
В качестве менеджера расписания скрипта временно выступает bash-скрипт `./app/scheduler.sh`

---

###  Запуск тестов
```bash
make test
```

### Алгоритм работы скрипта загрузки:

* скрипт на вход получает диапазон дат, за который необходимо найти данные;
* по пути` ./app/src/stations.py` расположен файл со станциями:

```python
class Station(NamedTuple):
  id: str
  name: str
  latitude: float
  longitude: float
  url: str
  
Station('23103', 'Khodovarikha', 68.933089, 53.758690, 'https://rp5.ru/Архив_погоды_в_Ходоварихе')
Station('23112', 'Varandey', 68.824039, 58.068760, 'https://rp5.ru/Архив_погоды_в_Варандее')
...
```

* скрипт запускает [ChromeWebdriver](https://chromedriver.chromium.org/), управляемый библиотекой
[selenium](https://selenium-python.readthedocs.io/)
* скрипт парсит веб-страницы, которые закреплены за каждой из станции и согласно сценарию, отправляет запрос на
  загрузку архива с необходимыми данными.
* после загрузки архив распаковывается, данные валидируются и конвертируются в формат <code>.geojson</code>
* для каждой из станций сценарий повторяется, а данные объеденяются в 
**[FeatureCollection](https://ru.wikipedia.org/wiki/GeoJSON)**. в едином <code>result.geojson</code>.
* результат дампится в директорию `./app/src/data/`

---

*Образец получаемых данных:*

```json
{
    "type": "FeatureCollection",
    "features": [
        {
            "type": "Feature",
            "geometry": {
                "type": "Point",
                "coordinates": [
                    33.098581,
                    68.915173
                ]
            },
            "properties": {
                "DATETIME": "16.05.2023 12:00",
                "T": 19.9,
                "Po": 753.7,
                "P": 758.2,
                "Pa": -0.1,
                "U": 33,
                "DD": "Ветер, дующий с юго-запада",
                "Ff": 6,
                "ff10": 10.0,
                "ff3": 12.0,
                "N": "70 – 80%.",
                "WW": " ",
                "W1": null,
                "W2": null,
                "Tn": null,
                "Tx": null,
                "Cl": "Кучевые средние или мощные или вместе с кучевыми разорванными, или с кучевыми...",
                "Nh": "20–30%.",
                "H": "600-1000",
                "Cm": "Клочья (часто чечевицеобразные) высококучевых просвечивающих...",
                "Ch": "Перистые когтевидные или нитевидные или первые и вторые, распространяющиеся по небу...",
                "VV": 50.0,
                "Td": 2.9,
                "RRR": null,
                "tR": null,
                "E": null,
                "Tg": null,
                "E'": null,
                "sss": null
            }
        }
    ]
}
```
